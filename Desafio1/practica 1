pipeline {
    agent any
    
    parameters {
        string (name: 'login', defaultValue: '', description: 'username/login')
        string (name: 'nombre', defaultValue: '', description: 'nombre de usuario')
        string (name: 'apellido', defaultValue: '', description: 'nombre del usuario')
        choice (name: 'departamento', choices: ['contabilidad','finanzas','tecnologia'], description: 'Selecciona el departamento')
    }

    stages {
        stage('Validacion de datos') {
            steps {
                echo "Registrando al usuario ${params.login}"
                echo "Nombre: ${params.nombre}"
                echo "Apellido: ${params.apellido}"
            }
        }
        stage('Generacion de password'){            
            steps {
                script {
                    PASSWORD = sh(script: 'openssl rand -base64 12', returnStdout: true).trim()
                    echo "Se generó la pssword ${PASSWORD}"
                }
            }            
        }
        stage('Creacion del Usuario'){
            steps {
                script {
                    sh "sudo useradd -m -s /bin/bash ${params.login}"
                    echo "Se generó el usuario ${params.login}!!"
                    sh "sudo usermod -aG ${params.departamento} ${params.login}"
                    sh "echo '${params.login}:${PASSWORD}' | sudo chpasswd"
                    echo "Se asignó la password ${PASSWORD}"
                }
            }
            
        }
    }
}
